% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/kinfitr_spline_tac.R
\name{spline_tac}
\alias{spline_tac}
\title{Spline-based Reference TAC Fitting}
\usage{
spline_tac(
  t_tac,
  tac,
  weights = NULL,
  frameStartEnd = NULL,
  timeStartEnd = NULL,
  t0.lower = 0,
  t0.upper = 5,
  k = -1
)
}
\arguments{
\item{t_tac}{Numeric vector of times for each frame in minutes. We use the
time halfway through the frame as well as a zero. If a time zero frame is
not included, it will be added.}

\item{tac}{Numeric vector of radioactivity concentrations in the tissue for
each frame. We include zero at time zero: if not included, it is added.}

\item{weights}{Optional. Numeric vector of the weights assigned to each frame
in the GAM fitting (not used in NLS optimisation). We include zero at time
zero: if not included, it is added. If not specified, uniform weights will
be used.}

\item{frameStartEnd}{Optional. This allows one to specify the beginning and
final frame to use for modelling, e.g. c(1,20).}

\item{timeStartEnd}{Optional. This allows one to specify the beginning and
end time point instead of defining the frame numbers using frameStartEnd.
This function will restrict the model to all time frames whose t_tac is
between the values, i.e. c(0,5) will select all frames with midtimes
during the first 5 minutes.}

\item{t0.lower}{Lower bound for the fitting of t0. Default is 0.}

\item{t0.upper}{Upper bound for the fitting of t0. Default is 5.}

\item{k}{Basis dimension for the smooth term, controlling wiggliness. Higher
values allow more flexible (wiggly) fits. Default is -1, which allows mgcv
to choose the dimension automatically. Typical values range from 5 (smooth)
to 15 (flexible).}
}
\value{
A list with a data frame of the fitted parameters \code{out$par},
  the t0 fit object \code{out$fit}, the final GAM fit object
  \code{out$gam_fit}, the model weights \code{out$weights}, and a dataframe
  containing the TACs both of the data and the fitted values \code{out$tacs}.
  Predicted values can be extracted using predict().
}
\description{
This function fits a TAC using a piecewise approach: NLS to optimize
t0 (the time when the curve starts rising from zero), and GAM to fit the curve
after t0. The model is intended for either de-noising in the case of severe
noise, or alternatively estimating the noise of a given TAC.
}
\details{
The model fits the curve in two pieces:
  \itemize{
    \item Before t0: TAC = 0
    \item After t0: TAC ~ s(sqrt(t_tac - t0), k=k) using mgcv::gam with REML
  }
  Any predicted values below zero are set to 0. The k parameter controls the
  basis dimension of the smooth, which affects how wiggly the fitted curve can
  be. Lower values produce smoother fits, higher values allow more flexibility.
}
\examples{

data(simref)

t_tac <- simref$tacs[[2]]$Times
tac <- simref$tacs[[2]]$Reference
weights <- simref$tacs[[2]]$Weights

fit <- spline_tac(t_tac, tac, weights)
}
\author{
Granville J Matheson, \email{mathesong@gmail.com}
}
